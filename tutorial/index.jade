.chapter(data-title='Server Notifications and Alerts')
  .step(data-file='config/administrators.yml')
    :markdown
      ## What Does This Thing Do?

      This [Ruby on Rails](//rubyonrails.org/) sample application demonstrates
      how to send SMS alerts to a list of system administrators if something goes
      wrong on your server.

      In this tutorial, we'll show you the key bits of code
      to make this work.

    p
      a(href="https://customers.twilio.com/178/emc/", target="_blank").
        See how EMC uses Twilio SMS to send IT alerts to 68,000 employees.

    :markdown
      Let's get started!

      ---

      **See Also:**
      * [Getting Started with Rails](//guides.rubyonrails.org/getting_started.html)
      * [Twilio Ruby Helper Library: Getting Started](//twilio-ruby.readthedocs.org/en/latest/index.html#getting-started)

  .step(data-file='config/administrators.yml')
    :markdown
      ## List of Server Admins

      Create a list of administrators who should be notified if a server error occurs.
      The only requirement we have is a `phone_number`.

      ---

      **See Also:**
      * [Ruby Docs: YAML](//ruby-doc.org/stdlib-2.3.1/libdoc/yaml/rdoc/YAML.html)

  .step(
    data-file='app/controllers/notifications_controller.rb',
    data-highlight='40-41')
    :markdown
      ## Configure Twilio Client

      In order to send a message we'll need to initialize the Twilio REST client
      which requires reading our `TWILIO_ACCOUNT_SID` and `TWILIO_AUTH_TOKEN`
      environment variables.

      ---

      **See Also:**
      * [Twilio Ruby Helper Library: Authentication](//twilio-ruby.readthedocs.org/en/latest/usage/basics.html#authentication)
      * [Ruby Docs: Environment Variables](//ruby-doc.org/core-2.3.1/ENV.html)

  .step(
    data-file='app/controllers/notifications_controller.rb',
    data-highlight='2-4')
    :markdown
      ## Handle All Exceptions on a Controller

      Here we ensure any [`StandardError`](//ruby-doc.org/core-2.2.0/Exception.html) 
      triggers our alert method with [`rescue_from`](//api.rubyonrails.org/classes/ActiveSupport/Rescuable/ClassMethods.html#method-i-rescue_from).

      ---

      **See Also:**
      * [Rails Guides: Rescuing in the Controller](//guides.rubyonrails.org/action_controller_overview.html#rescue)

  .step(
    data-file='app/controllers/notifications_controller.rb',
    data-highlight='7-13')
    :markdown
      ## Create a custom alert message

      Here we create an alert message to send out via text message. You might also
      decide to include a picture with your alert message, maybe a screenshot of the
      application when the crash happened?

  .step(
    data-file='app/controllers/notifications_controller.rb',
    data-highlight='15-25')
    :markdown
      ## Reading the Admins from the YAML File

      Next we read the admins [from our YAML file](//ruby-doc.org/stdlib-2.3.1/libdoc/yaml/rdoc/YAML.html#module-YAML-label-Usage)
      and send alert messages to each of them with the private `send_message` method.

  .step(
    data-file='app/controllers/notifications_controller.rb',
    data-highlight='39-50')
    :markdown
      ## Sending a Text Message

      There are the three parameters needed to [send an SMS](//www.twilio.com/docs/quickstart/ruby/sms/sending-via-rest)
      using the [Twilio REST API](//www.twilio.com/docs/api/rest):
      `from:`, `to:`, and `body:`. After the message is sent, we print out the phone
      number we're texting. [US phone numbers](//www.twilio.com/help/faq/sms/is-mms-supported-for-all-carriers-in-us-and-canada)
      can also send an image with the message.

      ---

      **See Also:**
      * [Twilio REST API: Messages](//www.twilio.com/docs/api/rest/message)
      * [Programmable SMS Logs](//www.twilio.com/console/sms/logs)

  .step
    :markdown
      ## Where to Next?

      That's it! We've just implemented an automated server notification system 
      that can send you server alerts if anything goes wrong. If you're a Ruby
      developer working with Twilio, you might want to check out these other
      tutorials.

      [**Two-Factor Authentication**](//www.twilio.com/docs/howto/walkthrough/two-factor-authentication/ruby/rails)

      Increase the security of your login system by verifying a user's mobile
      phone in addition to their password.

      [**Appointment Reminders**](//www.twilio.com/docs/howto/walkthrough/appointment-reminders/ruby/rails)

      Send your customers a text message when they have an upcoming appointment - 
      this tutorial shows you how to do it from a background job.

      ### Did this help?

      Thanks for checking out this tutorial! If you have any feedback
      to share with us, we'd love to hear it. [Contact the Twilio Developer
      Education Team](mailto:deved-oss@twilio.com) to let us know what you think.
